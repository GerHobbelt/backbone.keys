/*!
 * backbone.keys.js v0.1
 * Copyright 2012, Raymond Julin (@nervetattoo)
 * backbone.keys.js may be freely distributed under the MIT license.
 */
(function(){var e=this.Backbone,t=this._,n=this.document,r=this.$,i=e.View.prototype.delegateEvents,s=function(e){return e.length===1?e.toUpperCase().charCodeAt(0):o[e]},o={backspace:8,tab:9,enter:13,space:32,shift:16,ctrl:17,alt:18,meta:91,caps_lock:20,esc:27,num_lock:144,page_up:33,page_down:34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,"delete":46,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123};t.each({options:"alt","return":"enter"},function(e,t){o[t]=o[e]}),e.View=e.View.extend({bindKeysOn:"keydown",bindKeysScoped:!1,_keyEventBindings:null,delegateEvents:function(e){i.apply(this,e||[]),this.delegateKeys()},delegateKeys:function(e){this.undelegateKeys(),e=e||this.keys;if(e){t.each(e,function(e,t){this.keyOn(t,e)},this);var i=this.bindKeysScoped||typeof r=="undefined"?this.$el:r(n);i.on(this.bindKeysOn,t.bind(this.triggerKey,this))}},undelegateKeys:function(){this._keyEventBindings={}},keyName:function(e){var t;for(t in o)if(o[t]===e)return t;return String.fromCharCode(e)},triggerKey:function(e){var n;t.isObject(e)?n=e.which:t.isString(e)?n=s(e):t.isNumber(e)&&(n=e),t(this._keyEventBindings[n]).each(function(n){var r=!0;n.modifiers&&(r=t(n.modifiers).all(function(t){return e[t+"Key"]===!0})),r&&n.method(e,n.key)})},keyOn:function(e,n){e=e.split(" ");if(e.length>1){var r=e.length;while(r--)this.keyOn(e[r],n);return}e=e.pop().toLowerCase();var i=e.split("+");e=i.shift();var o=s(e);this._keyEventBindings.hasOwnProperty(o)||(this._keyEventBindings[o]=[]),t.isFunction(n)||(n=this[n]),this._keyEventBindings[o].push({key:e,modifiers:i||!1,method:t.bind(n,this)})},keyOff:function(e,n){n=n||!1;if(e===null)return this._keyEventBindings={},this;var r=s(e);return t.isFunction(n)||(n=this[n]),n?(this._keyEventBindings[r]=t.filter(this._keyEventBindings[r],function(e,t){return e.method===n}),this):(this._keyEventBindings[r]=[],this)}})}).call(this);