/*!
 * backbone.keys.js v0.1
 * Copyright 2012, Raymond Julin (@nervetattoo)
 * backbone.keys.js may be freely distributed under the MIT license.
 */
(function(){var a=this.Backbone,b=this._,c=this.document,d=this.$,e=a.View.prototype.delegateEvents,f=function(a){return a.length===1?a.toUpperCase().charCodeAt(0):g[a]},g={backspace:8,tab:9,enter:13,space:32,shift:16,ctrl:17,alt:18,meta:91,caps_lock:20,esc:27,num_lock:144,page_up:33,page_down:34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,"delete":46,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123};b.each({options:"alt","return":"enter"},function(a,b){g[b]=g[a]}),a.View=a.View.extend({bindKeysOn:"keydown",bindKeysScoped:!1,_keyEventBindings:null,delegateEvents:function(a){e.apply(this,a||[]),this.delegateKeys()},delegateKeys:function(a){this.undelegateKeys(),a=a||this.keys;if(a){b.each(a,function(a,b){this.keyOn(b,a)},this);var e=this.bindKeysScoped?this.$el:d(c);e.on(this.bindKeysOn,b.bind(this.triggerKey,this))}},undelegateKeys:function(){this._keyEventBindings={}},keyName:function(a){var b;for(b in g)if(g[b]===a)return b;return String.fromCharCode(a)},triggerKey:function(a){var c;b.isObject(a)?c=a.which:b.isString(a)?c=f(a):b.isNumber(a)&&(c=a),b(this._keyEventBindings[c]).each(function(c){var d=!0;c.modifiers&&(d=b(c.modifiers).all(function(b){return a[b+"Key"]===!0})),d&&c.method(a,c.key)})},keyOn:function(a,c){a=a.split(" ");if(a.length>1){var d=a.length;while(d--)this.keyOn(a[d],c);return}a=a.pop().toLowerCase();var e=a.split("+");a=e.shift();var g=f(a);this._keyEventBindings.hasOwnProperty(g)||(this._keyEventBindings[g]=[]),b.isFunction(c)||(c=this[c]),this._keyEventBindings[g].push({key:a,modifiers:e||!1,method:b.bind(c,this)})},keyOff:function(a,c){c=c||!1;if(a===null)return this._keyEventBindings={},this;var d=f(a);return b.isFunction(c)||(c=this[c]),c?(this._keyEventBindings[d]=b.filter(this._keyEventBindings[d],function(a,b){return a.method===c}),this):(this._keyEventBindings[d]=[],this)}})}).call(this);
